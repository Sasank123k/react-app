const handleSubmit = () => {
  if (!selectedSor) {
    showShowMessageBar('Please select a SOR before submitting.', 'warning');
    return;
  }

  // --- Validation Logic Starts Here ---
  const errors = [];

  // 1. Validate SOR Data
  for (const key in sorData) {
    if (!sorData[key]) {
      errors.push(`SOR Details: '${key}' is required.`);
    }
  }

  // 2. Validate App Data only if the box is checked
  if (treatAsApp) {
    // Check simple app fields
    if (!appData.userAppField1) errors.push("Application Details: 'userAppField1' is required.");
    if (!appData.userAppField2) errors.push("Application Details: 'userAppField2' is required.");
    if (!appData.userAppField3) errors.push("Application Details: 'userAppField3' is required.");
    
    // Check nested map fields
    if (!appData.flowMachineMap?.edl) errors.push("Flow Machine Map: 'EDL' is required.");
    if (!appData.flowMachineMap?.ingress) errors.push("Flow Machine Map: 'Ingress' is required.");
    if (!appData.securityMap?.firewall) errors.push("Security Map: 'Firewall' is required.");
    if (!appData.securityMap?.encryption) errors.prush("Security Map: 'Encryption' is required.");
  }

  // 3. If there are any errors, show them and stop
  if (errors.length > 0) {
    showShowMessageBar(errors.join(' \n'), 'warning');
    return;
  }
  // --- Validation Logic Ends Here ---


  // If validation passes, proceed with saving the data
  saveOnboardingDetails();
};
