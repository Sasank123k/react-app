// File: src/main/java/com/wellsfargo/utcap/controller/JilFileController.java
package com.wellsfargo.utcap.controller;

import com.wellsfargo.utcap.model.JilFile;
import com.wellsfargo.utcap.service.JilFileService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/jilData")
public class JilFileController {

    private static final Logger logger = LoggerFactory.getLogger(JilFileController.class);

    private final JilFileService service;

    @Autowired
    public JilFileController(JilFileService service) {
        this.service = service;
    }

    @GetMapping("/{requirementId}")
    public ResponseEntity<JilFile> getJilData(@PathVariable String requirementId) {
        try {
            JilFile jilFile = service.getOrBuildJilData(requirementId);
            return ResponseEntity.ok(jilFile);
        } catch (Exception e) {
            logger.error("Failed to get JIL data for requirementId: {}", requirementId, e);
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(null);
        }
    }

    @PutMapping("/{requirementId}")
    public ResponseEntity<JilFile> updateJilData(@PathVariable String requirementId,
                                                 @RequestBody JilFile jilFileData) {
        try {
            JilFile updated = service.saveJilData(requirementId, jilFileData.getJilFiles());
            return ResponseEntity.ok(updated);
        } catch (Exception e) {
            logger.error("Failed to update JIL data for requirementId: {}", requirementId, e);
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(null);
        }
    }
}
