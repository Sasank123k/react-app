@Test
public void testTriggerBuildAndGetBuildDetails_ioException() throws Exception {
    // 1. Set up a valid master mapping so that getJenkinsMasterUrl("owner") returns a dummy URL.
    Map<String, String> mastersMap = new HashMap<>();
    mastersMap.put("owner", "http://dummy-master/");
    Mockito.when(jenkinsProperties.getMasters()).thenReturn(mastersMap);

    // 2. Stub getLatestBuildNumber() to return a valid baseline (e.g., 100) so that triggerBuildAndGetBuildDetails proceeds.
    Mockito.doReturn(100).when(jenkinsClient).getLatestBuildNumber("owner", "repo", "branch");

    // 3. Use lenient stubbing for getCrumb() so that it throws an IOException.
    Mockito.lenient().doThrow(new IOException("I/O error")).when(jenkinsClient).getCrumb();

    // 4. Call the method and expect a JenkinsApiException wrapping the IOException.
    JenkinsApiException exception = assertThrows(JenkinsApiException.class, () ->
          jenkinsClient.triggerBuildAndGetBuildDetails("req1", "owner", "repo", "branch", Collections.emptyList()));
    assertTrue(exception.getMessage().contains("I/O error"));
}
